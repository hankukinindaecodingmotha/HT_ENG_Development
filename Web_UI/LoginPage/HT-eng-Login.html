<!DOCTYPE html>
<html lang="ko">

<head>
  <meta charset="UTF-8" />
  <title>Login Page</title>
  <link rel="stylesheet" href="HT-eng-LoginStyle.css" />
  <!-- 헤더 CSS/아이콘 (절대경로) -->
  <link rel="stylesheet" href="/Web_UI/Components/Header/HT_eng-header.css" />
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.0/css/all.min.css" />
  <!-- 고정 헤더가 컨텐츠를 가리지 않도록 여백 추가 -->
  <style>
    body {
      padding-top: 100px;
    }
  </style>
</head>

<body>
  <!-- 상단 바 컴포넌트 주입 컨테이너 -->
  <div id="header-container"></div>

  <div class="login-container">
    <h1>HTeng</h1>
    <p>에 오신 걸 환영합니다.</p>
    <input type="text" id="username" class="login-input" placeholder="ID" />
    <input type="password" id="password" class="login-input" placeholder="Password" />
    <div class="login-actions">
      <span id="signinBtn">sign in</span>
      <div class="divider"></div>
      <span id="signupBtn" style="opacity:.5; pointer-events:none;">sign up</span>
      <div class="divider"></div>
      <span id="helpBtn">Problem</span>
    </div>
  </div>

  <!-- 헤더 로더 스크립트 (절대경로) -->
  <script defer src="/Web_UI/Components/Header/HT_eng-header.js"></script>

  <script>
    // 로그인 → 서버 JWT → sessionStorage 저장 후 역할별 이동 (절대경로 사용)
    document.getElementById('signinBtn').addEventListener('click', async () => {
      const username = document.getElementById('username').value.trim();
      const password = document.getElementById('password').value.trim();
      if (!username || !password) { alert('ID와 비밀번호를 입력하세요.'); return; }
      try {
        const res = await fetch('http://localhost:3000/api/auth/login', {
          method: 'POST', headers: { 'Content-Type': 'application/json' },
          body: JSON.stringify({ username, password })
        });
        if (!res.ok) {
          const e = await res.json().catch(() => ({ message: '로그인 실패' }));
          alert(e.message || '로그인 실패');
          return;
        }
        const data = await res.json();
        sessionStorage.setItem('auth_token', data.token);
        sessionStorage.setItem('auth_user', data.username);
        sessionStorage.setItem('auth_role', data.role);
        // 역할별 이동: admin → 관리자, 일반 → 프로필 (절대경로)
        window.location.href =
          data.role === 'admin'
            ? '/Web_UI/Admin/HT_eng-Admin.html'
            : '/Web_UI/User/HT_eng-Profile.html';
      } catch (err) {
        console.error(err); alert('서버와 통신할 수 없습니다.');
      }
    });
  </script>
</body>

</html>